---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

`r lifecycle::badge("experimental")`

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# constructive 

{constructive} prints code that can be used to recreate R objects. In a sense it
is similar to `base::dput()` but {constructive} strives to use "natural" constructors
(`factor` for factors, `as.Date()` for dates, `data.frame()` for data frames etc),
in order to get output readable by humans.

Some use cases : 

* snapshot test
* Exploring objects (alternative to `dput()` or `str()`)
* Creating reproducible examples from existing data
* Comparing two objects (using `construct_diff()`)

## Installation

Install with:

```
remotes::install_github("cynkra/constructive")
```

## Examples

A few examples compared to their `dput()` output.

```{r, error = TRUE}
library(constructive)

construct(head(iris, 2))
dput(head(iris, 2))

construct(.leap.seconds)
dput(.leap.seconds)

library(dplyr, warn = F)
grouped_band_members <- group_by(band_members, band)
dput(grouped_band_members)
construct(grouped_band_members)
```

We can provide to the `data`argument a list, environment, or package where to look
for data so we don't print more than necessary, for example improving the previous example:

```{r}
construct(grouped_band_members, data = "dplyr")
```

We can also trim the output and display onle `max_atomic` element at most in a vector :

```{r}
construct(list(iris = iris, cars = cars), max_atomic = 3)
```
If we use `max_atomic = 0` we build a prototype :

```{r}
construct(list(iris = iris, cars = cars), max_atomic = 0)
```
Some other options :

```{r}
construct(band_members, tribble = TRUE)
construct(as.data.frame(band_members), read.table = TRUE)
```
## Limitations

Environments are not always possible to reproduce but we support some common cases.
Due to this several objects such as formulas, srcrefs, R6 objects, ggplot objects
etc might not be reproducible exactly. If an approximation is enough you might
set `check = FALSE`, `ignore_srcref = TRUE`, `env_as_list = FALSE`.

## construct_diff

An alternative to `waldo::compare()` (looks best in the IDE without `interactive = FALSE`) 

```{r}
# The args max_atomic, max_boy and env_as_list can be used to reduce output,
# here we want to see what adding geom_point() does to a ggplot
library(ggplot2)
construct_diff(
  # max_atomic limits number of displayed elements for atomic vectors
  max_atomic = 4, 
  # if env_as_list is FALSE instead of defining unnamed envs as 
  # `as.environment(list(elt = ...))` we simply use `new.env()`
  env_as_list = FALSE, 
  interactive = FALSE,
  ggplot(cars, aes(speed, dist)),
  ggplot(cars, aes(speed, dist)) + geom_point()
)
```

